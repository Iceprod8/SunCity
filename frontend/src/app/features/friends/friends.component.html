<ng-container>
  <div class="page-container pb-12">
    <div class="bg-[#f6f1e9] border border-amber-100 rounded-3xl shadow-xl shadow-amber-100/40 p-4 md:p-6 space-y-6">
      <app-page-header
        title="Amis"
        i18n-title="@@friends.title"
        subtitle="Gérez votre liste d'amis."
        i18n-subtitle="@@friends.subtitle">
      </app-page-header>
      <div class="grid lg:grid-cols-3 gap-4">
        <div class="lg:col-span-1 bg-white rounded-2xl shadow p-4 border border-amber-100 space-y-4">
          <h3 class="text-sm font-semibold text-slate-700" i18n="@@friends.form.title">Ajouter un ami</h3>
          <div class="space-y-3">
            <div class="space-y-1">
              <label class="text-xs text-slate-500" i18n="@@friends.form.searchLabel">Rechercher un utilisateur</label>
              <input
                [(ngModel)]="searchTerm"
                class="w-full px-3 py-2 rounded-lg border border-amber-200 bg-white focus:outline-none focus:ring-2 focus:ring-amber-300 text-sm"
                placeholder="Nom ou email"
                i18n-placeholder="@@friends.form.searchPlaceholder" />
              <p class="text-xs text-slate-500" *ngIf="!filteredChoices.length" i18n="@@friends.form.noChoices">
                Aucun utilisateur disponible à ajouter (ou tous déjà amis).
              </p>
            </div>
            <div class="space-y-1">
              <label class="text-xs text-slate-500" i18n="@@friends.form.noteLabel">Note (optionnel)</label>
              <textarea
                [(ngModel)]="note"
                rows="2"
                class="w-full px-3 py-2 rounded-lg border border-amber-200 bg-white focus:outline-none focus:ring-2 focus:ring-amber-300 text-sm"
                placeholder="Rappel ou détail"
                i18n-placeholder="@@friends.form.notePlaceholder"></textarea>
            </div>
            <p class="text-xs text-slate-500" i18n="@@friends.form.help">
              Choisissez un utilisateur dans la liste ci-dessous pour l'ajouter.
            </p>
          </div>

          <div class="space-y-2 mt-4">
            <div
              *ngFor="let user of filteredChoices"
              class="flex items-center justify-between gap-2 px-3 py-2 rounded-xl border border-amber-200 bg-amber-50 text-sm text-slate-700">
              <div>
                <p class="font-semibold">{{ user.username }}</p>
                <p class="text-xs text-slate-500">{{ user.email }}</p>
              </div>
              <button
                (click)="addFriendFromUser(user)"
                [disabled]="saving"
                class="px-3 py-1 rounded-full bg-amber-600 text-white text-xs font-semibold hover:bg-amber-700 disabled:opacity-60 disabled:cursor-not-allowed">
                <span i18n="@@friends.form.addButton">Ajouter</span>
              </button>
            </div>
          </div>
        </div>

        <div class="lg:col-span-2 bg-white rounded-2xl shadow p-4 border border-amber-100 space-y-4">
          <div class="flex items-center justify-between">
            <h3 class="text-sm font-semibold text-slate-700" i18n="@@friends.list.title">Liste des amis</h3>
            <span class="text-xs text-slate-500" i18n="@@friends.list.count">
              {{ friends.length }} contact(s)
            </span>
          </div>
          <div *ngIf="loading" class="text-sm text-slate-500" i18n="@@friends.list.loading">Chargement...</div>
          <div *ngIf="error && !loading" class="text-sm text-red-600" i18n="@@friends.list.error">Erreur de chargement des amis.</div>
          <div *ngIf="!loading && !friends.length" class="text-sm text-slate-500" i18n="@@friends.list.empty">Aucun ami pour le moment.</div>
          <div class="grid sm:grid-cols-2 gap-3" *ngIf="friends.length">
            <div *ngFor="let friend of friends" class="border border-amber-100 rounded-xl p-3 shadow-sm bg-amber-50/70">
              <div class="flex items-start justify-between gap-2 mb-2">
                <div>
                  <p class="text-sm font-semibold text-slate-800">{{ friend.user?.username || fallbackUserLabel }}</p>
                  <p class="text-xs text-slate-500">{{ friend.user?.city || fallbackCityLabel }}</p>
                  <p class="text-[11px] text-slate-500">{{ friend.user?.email }}</p>
                </div>
                <button class="text-xs text-red-600 hover:text-red-700" (click)="removeFriend(friend.id)" i18n="@@friends.list.removeButton">Supprimer</button>
              </div>
              <p class="text-xs text-slate-600" *ngIf="friend.note">{{ friend.note }}</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</ng-container>
